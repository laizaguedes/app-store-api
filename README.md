# app-store
## Estrutura de pastas

````bash
app-store-api/
‚îú‚îÄ‚îÄ node_modules/          # Depend√™ncias instaladas pelo npm, incluindo Express, Prisma, Zod, Stripe etc.
‚îú‚îÄ‚îÄ prisma/                # Configura√ß√µes e migrations do Prisma para gerenciar o banco de dados
‚îú‚îÄ‚îÄ public/                # Arquivos est√°ticos p√∫blicos (imagens, scripts, assets) servidos diretamente via Express
‚îú‚îÄ‚îÄ src/                   # C√≥digo-fonte da aplica√ß√£o escrito em TypeScript
‚îÇ   ‚îú‚îÄ‚îÄ controllers/       # Camada de controle da API: l√≥gica que recebe requisi√ß√µes e chama servi√ßos (ex: banner.ts, product.ts)
‚îÇ   ‚îú‚îÄ‚îÄ generated/         # C√≥digo gerado automaticamente pelo Prisma (client, tipos, etc)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ prisma/
‚îÇ   ‚îú‚îÄ‚îÄ libs/              # Bibliotecas internas e helpers reutiliz√°veis, como inst√¢ncia configurada do Prisma (prisma.ts)
‚îÇ   ‚îú‚îÄ‚îÄ routes/            # Defini√ß√£o das rotas da API e organiza√ß√£o das endpoints (ex: main.ts)
‚îÇ   ‚îú‚îÄ‚îÄ schemas/           # Schemas de valida√ß√£o e defini√ß√£o de contratos com Zod (ex: get-product-schema.ts)
‚îÇ   ‚îú‚îÄ‚îÄ services/          # Regras de neg√≥cio e opera√ß√µes mais complexas, separadas da camada de controle (ex: banner.ts, product.ts)
‚îÇ   ‚îî‚îÄ‚îÄ utils/             # Fun√ß√µes utilit√°rias e helpers variados usados ao longo do projeto (ex: get-absolute-image-url.ts, get-base-url.ts)
‚îÇ   ‚îî‚îÄ‚îÄ server.ts          # Ponto de entrada da aplica√ß√£o, onde o servidor Express √© configurado e iniciado
‚îú‚îÄ‚îÄ .env                   # Vari√°veis de ambiente (conex√£o com banco, chaves secretas, etc) ‚Äî carregadas no runtime
‚îú‚îÄ‚îÄ .gitignore             # Define arquivos e pastas que n√£o devem ser versionados (node_modules, .env, etc)
‚îú‚îÄ‚îÄ docker-compose.yml     # Configura√ß√£o para rodar containers Docker, facilitando orquestra√ß√£o e deploy local
‚îú‚îÄ‚îÄ package-lock.json      # Lockfile que registra vers√µes exatas das depend√™ncias instaladas
‚îú‚îÄ‚îÄ package.json           # Manifesto do projeto com scripts, depend√™ncias, configura√ß√µes do npm
‚îú‚îÄ‚îÄ README.md              # Documenta√ß√£o geral do projeto
‚îî‚îÄ‚îÄ tsconfig.json          # Configura√ß√£o do compilador TypeScript (target, m√≥dulos, paths, etc)
````

## Bibliotecas e Recursos

- prisma ‚Üí facilita a comunica√ß√£o entre a aplica√ß√£o e o banco de dados 
- express ‚Üí servidor web.
- cors ‚Üí permite o frontend falar com o backend.
- bcryptjs ‚Üí seguran√ßa de senhas.
- zod ‚Üí valida√ß√£o de dados.
- uuid ‚Üí gera IDs √∫nicos.
- stripe ‚Üí pagamentos online.
- swagger ‚Üí documenta√ß√£o da API

üî∑ O que √© o Prisma?
√â um ORM que facilita a comunica√ß√£o entre sua aplica√ß√£o e o banco de dados.

- Conecta seu c√≥digo a bancos como PostgreSQL, MySQL, SQL Server, MongoDB etc.
- Gera queries SQL automaticamente com base em modelos declarados em um arquivo de schema.
- D√° tipagem autom√°tica (principalmente com TypeScript), ent√£o voc√™ j√° sabe quais campos existem sem decorar o banco.
- Traz ferramentas como o Prisma Studio (interface visual para ver e editar dados).

üì¶ express
Framework minimalista para Node.js.

- Cria servidores HTTP de forma simples.
- Permite definir rotas (/login, /produtos, etc.).
- Facilita lidar com requisi√ß√µes e respostas (GET, POST, PUT, DELETE).

Exemplo:

````tsx
import express from "express";
const app = express();

app.get("/hello", (req, res) => {
  res.send("Ol√° mundo!");
});

app.listen(3000);
````

üîó cors
Middleware que habilita o CORS (Cross-Origin Resource Sharing).

- Necess√°rio quando seu frontend e backend est√£o em dom√≠nios/ports diferentes (ex.: React em http://localhost:5173 e API em http://localhost:3000).
- Sem ele, o navegador bloqueia a comunica√ß√£o.

Exemplo:

````tsx
import cors from "cors";
app.use(cors());
````

üîë bcryptjs
Biblioteca para hash de senhas.

- Nunca se deve salvar a senha real no banco.
- O bcryptjs gera um hash seguro que √© praticamente imposs√≠vel de reverter.
- Tamb√©m compara senhas inseridas com o hash salvo.

Exemplo:

````tsx
import bcrypt from "bcryptjs";

const hash = await bcrypt.hash("senha123", 10); 
const isValid = await bcrypt.compare("senha123", hash);
````

‚úÖ zod
Biblioteca de valida√ß√£o e tipagem de dados.

- Garante que os dados que chegam na API est√£o no formato certo.
- Muito usada para validar JSON de requisi√ß√µes.

Exemplo:

````tsx
import { z } from "zod";

const userSchema = z.object({
  email: z.string().email(),
  password: z.string().min(6),
});

userSchema.parse({ email: "teste@email.com", password: "123456" });
````

üîë uuid
Gera UUIDs (identificadores √∫nicos universais).

- Muito usado para criar IDs que n√£o se repetem (para usu√°rios, pedidos, etc.).

Exemplo:

````tsx
import { v4 as uuidv4 } from "uuid";

const id = uuidv4();
console.log(id); // ex: "6f2c6c68-77a5-4f30-98e1-2e1c8e9df9f7"
````

üí≥ stripe
SDK oficial da Stripe (plataforma de pagamentos).

- Permite processar cart√µes de cr√©dito, Pix (no Brasil), assinaturas, checkout online.
- Usado em sistemas que precisam de cobran√ßa online.

Exemplo:

````tsx
import Stripe from "stripe";
const stripe = new Stripe("SUA_CHAVE_SECRETA");

const paymentIntent = await stripe.paymentIntents.create({
  amount: 2000, // em centavos (R$20,00)
  currency: "brl",
});
````

## configura√ß√µes iniciais do projeto
### ‚ú®iniciar o projeto
````bash
npm init -y
````

### ‚ú®instalar as bibliotecas e recursos

````bash
npm i express cors bcryptjs zod uuid stripe
npm i -D @types/cors @types/express @types/node prisma typescript tsx
````

1. configurar o script do package.json
2. adicionar o type "module" no package.json

````bash
npx tsc --init
````

- Criar o arquivo de rotas src/routes/main.ts
- Configurar o arquivo src/server.ts para receber as rotas
- Configurar o src/routes/main.ts

1. criar o .gitignore
2. criar o .env
3. configurar o tsconfig para remover o que n√£o precisa
4. configurar o dockerfile para utilizar como banco local
    a. instalar e inicializar o docker(caso ainda n√£o o tenha)
    
    b. criar o arquivo dockerfile, exemplo simples:

      ````yml
      version: '3.8'

      services:
        postgres:
          image: postgres:latest
          container_name: postgres-app-store
          environment:
            POSTGRES_USER: admin
            POSTGRES_PASSWORD: postgres
            POSTGRES_DB: app-store-db
          ports:
            - "5432:5432"
          volumes:
            - pgdata:/var/lib/postgresql/data

        pgweb:
          image: sosedoff/pgweb
          container_name: pgweb
          ports:
            - "8081:8081"
          environment:
            PGWEB_DATABASE_URL: postgres://admin:postgres@postgres:5432/app-store-db?sslmode=disable
          depends_on:
            - postgres

      volumes:
        pgdata:
      ````
    
    c. criar variavel de banco no .env
      ````
        DATABASE_URL="postgresql://admin:postgres@localhost:5432/app-store-db?schema=public"
      ````
    
    d. inicializar o container:
      ````bash
        docker-compose up -d
        docker start postgres-app-store
      ````
    
    e. caso queira visualizar o banco basta executar o comando
      ````bash
        docker start pgweb
      ````
5. instala√ß√£o e configura√ß√£o do prisma

    a. Instalar e inicializar as configura√ß√µes padr√µes pelo prisma

      ````bash
      npx prisma init
      npx prisma generate
      ````

    b. Outra alternativa para instala√ß√£o
    - instalar o Prisma Client e a CLI

      ````bash
        npm install prisma --save-dev
        npm install @prisma/client
      ````

    - criar a pasta e o arquivo prisma/schema.prisma com o conte√∫do b√°sico, exemplo:

      ````js
      generator client {
        provider = "prisma-client-js"
        output = "../src/generated/prisma"
      }

      datasource db {
        provider = "postgresql" // ou mysql/sqlite/etc
        url      = env("DATABASE_URL")
      }
      ````
    
    Ap√≥s a instala√ß√£o do prisma vamos agora para o prisma estabelecer conex√£o
    - cirar pasta e arquivo src/libs/prisma.tsx
    - a conex√£o pode ser encontrada na documenta√ß√£o dispon√≠vel no site prisma (https://www.prisma.io/docs/orm/prisma-client/setup-and-configuration/databases-connections)
6. instalar e configurar o ZOD
7. instalar e configurar o swagger
    a.instalar o swagger

    ````bash
    npm install zod-to-openapi swagger-ui-express
    ````

    b. criar e configurar o arquivo src/libs/swagger.ts, exemplo:

    ````ts
    // swagger.tsx
    import { OpenApiGeneratorV3 } from 'zod-to-openapi';
    import {
      UserCreateSchema,
      UserResponseSchema,
      UserUpdateSchema,
    } from './zod/user';

    const generator = new OpenApiGeneratorV3([
      UserCreateSchema,
      UserResponseSchema,
      UserUpdateSchema,
    ]);

    const openApiDocument = generator.generateDocument({
      openapi: '3.0.0',
      info: {
        title: 'Minha API',
        version: '1.0.0',
      },
      paths: {
        '/users': {
          post: {
            summary: 'Criar usu√°rio',
            requestBody: {
              content: {
                'application/json': {
                  schema: generator.getSchemaRef(UserCreateSchema),
                },
              },
              required: true,
            },
            responses: {
              '201': {
                description: 'Usu√°rio criado',
                content: {
                  'application/json': {
                    schema: generator.getSchemaRef(UserResponseSchema),
                  },
                },
              },
            },
          }
        },
      },
    });
    ````

    c. no arquivo src/server.ts onde fica a api, adicionar o swagger da seguinte maneira:

    ````tsx
    // index.ts
    import express from 'express';
    import swaggerUi from 'swagger-ui-express';
    import openApiDocument from './swagger';

    const app = express();
    app.use(express.json());

    app.use('/api-docs', swaggerUi.serve, swaggerUi.setup(openApiDocument));

    app.listen(3000, () => {
      console.log('üöÄ Server running on http://localhost:4000');
      console.log('üìò Swagger: http://localhost:3000/api-docs');
    });
    ````

## passos para rodar o projeto

````bash
npm i
docker-compose up -d
docker start postgres-app-store
npm run dev
````

## passos para criar o banco de dados com prisma

````bash
npx prisma migrate dev
````

## url de apoio
dashboard.stripe.com/test/dashboard